<!doctype html>
<html lang="en">
<head>
  <link rel="icon" href="logo.png">
  <script src="https://code.jquery.com/jquery-git.js"></script>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Restaurants</title>
  <meta name="description" content="High Thrills Theme Park">
  <meta name="author" content="SitePoint">
  <link rel="stylesheet" href="pnavbar.css">
  <link rel="stylesheet" href="reservation.css">
  <link rel="stylesheet" href="main.css">
  <link rel="stylesheet" href="portal.css">
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  <script src="https://kit.fontawesome.com/3aa210e078.js" crossorigin="anonymous"></script>
  <link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">
</head>
<body>
    <div style="position: relative; height: 60vh;" class="">
        <div style="position: relative; height: 60vh;" id="carouselExampleControls" class="r-carousel carousel slide" data-ride="carousel">
            <div style="position: relative; height: 60vh;" class="carousel-inner">
                <div class="carousel-item active">
                <img class="car-img d-block w-100" src="Whole-Wheat-Noodles-in-Coconut-Milk-and-Peanut-Sauce.png" alt="First slide">
                </div>
                <div class="carousel-item">
                  <img class="car-img d-block w-100" src="pasta-salad.jpeg" alt="Second slide">
                </div>
                <div class="carousel-item">
                  <img class="car-img d-block w-100" src="im-214963.jpeg" alt="Third slide">
                </div>
                
                <div class="carousel-item">
                  <img class="car-img d-block w-100" src="quesadilla-with-beans-and-cheese-29864-1.jpeg" alt="Fourth slide">
                </div>

              <!--  <div class="carousel-item">
                  <img class="d-block w-100" src="Who-Designs-Amusement-Park-Rides.jpeg" alt="Third slide">
                </div> -->
                
            </div>
            <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
            </a>
        </div>
        <div style = "color: white; background-color: rgba(0, 0, 0, 0.4); padding: 10px;"class="title">Restaurants</div>
    </div>
    <div id="navigation">
      <script src="https://apis.google.com/js/api:client.js"></script>
      <script>
        var googleUser = {};
        var startApp = function() {
          gapi.load('auth2', function(){
            // Retrieve the singleton for the GoogleAuth library and set up the client.
            auth2 = gapi.auth2.init({
              client_id: '670268468186-s7jhd7bhkmnpssqe9r3rbsulde7p8a4h.apps.googleusercontent.com',
              cookiepolicy: 'single_host_origin',
              // Request scopes in addition to 'profile' and 'email'
              //scope: 'additional_scope'
            });
            attachSignin(document.getElementById('customBtn'));
            attachSignin(document.getElementById('customBtn2'));
          });
        };

        function attachSignin(element) {
          //console.log(element.id);
          auth2.attachClickHandler(element, {}, function(googleUser){
            onSignIn(googleUser);
          });
          return false;
        }
      </script>
      <nav onresize="editUser()" id="p-nav"class="header-top topnav fixed-top navbar navbar-expand-lg navbar-dark bg-dark">
        <a class="navbar-brand brand" id="brand" href="/">High Thrills Entertainment Park</a>
        <button class="navbar-toggler float-right" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse"  id="navbarNav">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item">
              <a class="nav-link" href="/restaurants">Restaurants</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/rides">Rides</a>
            </li>
          </ul>
          <span id="account">
            <button class="nav-item btn btn-outline-primary mr-2" data-toggle="modal" data-target="#signUpModal">Sign Up</button>
            <button class="nav-item btn btn-outline-success" data-toggle="modal" data-target="#loginModal">Log In</button>
            </span>
        </div>
        <script src="https://code.jquery.com/jquery-git.js"></script>
        <script>
          var name = "";

          var nick = "";


          if (document.cookie.indexOf(";", document.cookie.indexOf("name=")) ==  -1 && document.cookie.indexOf("name=") != -1){
              name = document.cookie.slice(document.cookie.indexOf("name=") + 5, document.cookie.length);
          }
          else if (document.cookie.indexOf("name=") != -1){
              name = document.cookie.slice(document.cookie.indexOf("name=") + 5, document.cookie.indexOf(";", document.cookie.indexOf("name=") + 5));
          }

          if (document.cookie.indexOf("nick") == -1){
              nick = name;
          }
          else{
              if (document.cookie.indexOf(";", document.cookie.indexOf("nick=")) != -1){
                  nick=document.cookie.slice(document.cookie.indexOf("nick=") + 5, document.cookie.indexOf(";", document.cookie.indexOf("nick=") + 5));
              }
              else{
                  nick = document.cookie.slice(document.cookie.indexOf("nick=") + 5, document.cookie.length);
              }
                  
          }

          if(document.cookie.indexOf("name") != -1) {
            $("#account").children().remove();
            const account = '<div id="user" class="dropdown"> \
              <button class="btn btn-danger dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">';
            const accountnext = '</button> \
              <div id="user-menu" class="dropdown-menu" aria-labelledby="dropdownMenuButton"> \
                <a class="dropdown-item" href="/itinerary">Itinerary</a> \
                <a onclick="removeG()" onload="changeForms()" id="pain" class="dropdown-item" href="./logout">Log Out</a> \
              </div> \
            </div>';
            //name = document.cookie.slice(document.cookie.indexOf("name=") + 5, document.cookie.length);
            $("#account").html(account + nick + accountnext);
            if(document.cookie.indexOf("name") != -1) {
              if($(document).width() < 992) {
                $("#user").removeClass("dropleft");
              } else {
                $("#user").addClass("dropleft");
              }
            }
          }
          else if (document.cookie.indexOf("ERROR=") != -1){

            var errorCode = document.cookie.slice(document.cookie.indexOf("ERROR=") + 6, document.cookie.length);
            switch (errorCode){

              case "1":
                window.alert("Sign Up Failed: Invalid email address (Error code: 1)");
                break;
              case "2":
                window.alert("Sign Up Failed: Password does not meet requirements (Must have at least 7 letters, a number, and a special character) (Error Code: 2)");
                break;
              case "3":
                window.alert("Sign Up Failed: Email already linked with existing account (Error Code: 3)");
                break;
              case "4":
                window.alert("Sign In Failed: Invalid email or password (Error Code: 4)");
                break;

            }
          // WORRY ABOUT THIS LATER
          
          // WORRY ABOUT THIS LATER
          }
        </script>
      </nav>

      <!--The Sign Up Modal-->
      <div class="modal fade" id="signUpModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLongTitle">Sign Up</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
            </div>
            <div class="modal-body">
              <form method="POST" action="/signup">
                <p class="mb-0" style="font-size: small;" aria-autocomplete="none">Email</p>
                <input class="modal-form" for="uname" name="email" type="text" placeholder="Email"/>
                <p class="mb-0" style="font-size: small;">Password</p>
                <input class="modal-form" for="pwd" name="pwd" type="password" placeholder="Password"/>
                <p class="mb-0" style="font-size: small;">Confirm Password</p>
                <input class="modal-form" for="repeatPwd" name="repeatPwd" type="password" placeholder="Repeat Password"/>
                <p class="mb-0" style="font-size: small;">Nickname (Optional)</p>
                <input class="modal-form" for="nickname" name="nickname" type="text" value="" placeholder="Nickname (Optional)"/>
                <button style="margin-top: 10px; width: 100%; border-radius: 9999px;" class="btn btn-primary" type="submit">Sign Up</button>
                <div style="display: inline-flex; position: relative; text-align: center; width: 100%;">
                  <div style="left: 0; margin-left: 5%; width: 40%; position: absolute; top: 50%; border: 1px solid black;"></div>
                  <div style="position: absolute; top: 50%; left:50%; transform: translate(-50%, -50%);">Or</div>
                  <div style="margin-right: 5%; right:0; width: 40%; position: absolute; top: 50%; border: 1px solid black;"></div>
                </div>
                <button id="customBtn" data-onsuccess="onSignIn" onclick="return false;" style="margin-top: 10px; width: 100%; border-radius: 9999px;" class="customGPlusSignIn btn btn-success">Sign Up with Google</button>
              </form>
            </div>
            <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <!--<button type="button" class="btn btn-primary">GO</button>-->
            </div>
        </div>
        </div>
      </div>


      <div class="modal fade" id="loginModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLongTitle">Log In</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
            </div>
            <div class="modal-body">
              <!--<form method="POST" action="/login">
                <input for="uname" name="uname" type="text" placeholder="Username"/>
                <input for="pwd" name="pwd" type="password" placeholder="Password"/>
                <button type="submit" class="btn btn-primary">SUBMIT</button>
              </form>-->
              <form method="POST" action="/signup">
                <p class="mb-0" style="font-size: small;" aria-autocomplete="none">Email</p>
                <input class="modal-form" for="uname" name="uname" type="text" placeholder="Username"/>
                <p class="mb-0" style="font-size: small;">Password</p>
                <input class="modal-form" for="pwd" name="pwd" type="password" placeholder="Password"/>
                <button style="margin-top: 10px; width: 100%; border-radius: 9999px;" class="btn btn-primary" type="submit">Log In</button>
                <div style="display: inline-flex; position: relative; text-align: center; width: 100%;">
                  <div style="left: 0; margin-left: 5%; width: 40%; position: absolute; top: 50%; border: 1px solid black;"></div>
                  <div style="position: absolute; top: 50%; left:50%; transform: translate(-50%, -50%);">Or</div>
                  <div style="margin-right: 5%; right:0; width: 40%; position: absolute; top: 50%; border: 1px solid black;"></div>
                </div>
              </form>
              <script src="https://apis.google.com/js/platform.js" async defer></script>
            <meta name="google-signin-client_id" content="670268468186-s7jhd7bhkmnpssqe9r3rbsulde7p8a4h.apps.googleusercontent.com">
            <form method="POST" action="/gsignin" id="gForm">
              <div style="display: none;">
                <input id="gUsername" for="gName" name="gName" type="text"/>
                <input id="gPwd" for="gPwd" name="gPwd" type="password"/>
                <input id="gNick" for="gNick" name="gNick" type="text"/>
              </div>
              <!--<div class="g-signin2" data-onsuccess="onSignIn"></div>-->
                <button id="customBtn2" data-onsuccess="onSignIn" onclick="return false;" style="margin-top: 10px; width: 100%; border-radius: 9999px;" class="customGPlusSignIn btn btn-success">Log In with Google</button>
            </form>
            </div>
            <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <!--<button type="button" class="btn btn-primary">GO</button>-->
            </div>
        </div>

        <script src="/socket.io/socket.io.js"></script>
        <script>
          startApp();
          var socket = io();
          if(name != "") {
            socket.emit("validate", name);
          }

          function removeG(){
            var auth2 = gapi.auth2.getAuthInstance();
            auth2.disconnect();
          }

          function onSignIn(googleUser){
            var profile = googleUser.getBasicProfile();
            document.getElementById("brand").text = "signing in...";
            // The ID token you need to pass to your backend:
            var id_token = googleUser.getAuthResponse().id_token;

            document.getElementById("gUsername").value = profile.getEmail();
            document.getElementById("gNick").value = profile.getGivenName();
            document.getElementById("gPwd").value = "g";
            if (name == ""){
              document.getElementById("gForm").submit();
            }
            document.getElementById("gForm").submit();
          }

          function changeForms(){
            //console.log("CHANGE FORMS ACTIVATED");

            /*ar forms = document.getElementsByTagName("form");
            for (form of forms){
                //console.log("BEFORE: " + form.action);
                form.action = "/restaurants/" + restaurantName.toLowerCase() + form.action.slice(form.action.lastIndexOf('/'), form.action.length);
                //console.log("AFTER: " + form.action);
            }

            var pain = document.getElementById("pain")
            pain.href = "/restaurants/" + restaurantName.toLowerCase() + pain.href.slice(pain.href.lastIndexOf('/'), pain.href.length);*/
          }

          // Edit navbar if user is admin
          socket.on("isAdmin", function() {
            var adminLink = document.createElement("a");
            adminLink.href = "/admin";
            adminLink.className = "dropdown-item";
            adminLink.text = "Admin";

            document.getElementById("user-menu").insertBefore(adminLink, document.getElementById("pain"));
          });
          
          // Reload page after login
          socket.on("reload", function(msg){
            //console.log("GOT ITTTT");
            window.location.reload();
          });
        </script>
        </div>
      </div>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
    /*$(function() {
        $("#navigation").load("pnavbar.html");
    });*/
    </script>
    <div class="px-4 py-4 text-center">
        <div class="container">Did you know we have the some of the best restaurants around the world? One of our restaurant holds 3 michelin stars and has people from around the globe wanting to eat there. Whether you desire a juicy steak, a chilling ice-cream during a summer day, an authentic American meal, a spicy hot dog, or some golden fried chicken, we have everything your hungry heart could desire. Our meals are the definition of perfection, excellence, quality. One cannot possibly decline the meals found at High Thrills. So, come to High Thrills to taste divinity from all five of our restaurants. </div>
    </div>
    <div id="portals">
      <div class="container py-2"></div>
    </div>
    <script src="/socket.io/socket.io.js"> </script>
    <script>
      var socket = io();
      var adData = [];
      window.onload = function() {
        var href = window.location.href;
        var restaurant = false;
        if (href.indexOf("restaurants") != -1){
          restaurant = true;
        }

        socket.emit("getAttractions", restaurant);
      }
      socket.on("receiveAttractions", function(msg){
        //console.log(msg);
        var element = $('#portals').find('.container');
        element[0].innerHTML = '';
        // construct cards through DOM
        $(function(){
          for(var i = 0; i < msg.length; ++i){
            var cardImg = document.createElement("img");
            cardImg.className = "p-img card-img";
            cardImg.src = msg[i].imagelocation;
            
            var cardTitle = document.createElement("h2");
            cardTitle.className = "card-title"
            cardTitle.innerText = msg[i].name;

            var cardHover = document.createElement("div");
            cardHover.className = "card-hover";
            cardHover.style = "width: 0%;";
            cardHover.id = msg[i].name + "-hover";

            var carrot = document.createElement("div");
            carrot.className = "portal fas fa-caret-right fa-10x float-right";
            carrot.style = "right: 1%;";
            carrot.id = msg[i].name;

            const current_name = msg[i].name;
            const current_id = msg[i].id;
            const current_name_hover = msg[i].name + "-hover";
            carrot.onclick = function() {
              for(carr of document.getElementsByClassName("portal")) {
                if(carr.id == current_name) {
                  continue;
                }
                carr.className = "portal fas fa-caret-right fa-10x float-right";
                carr.style = "right: 1%;";
              }
              for(carr of document.getElementsByClassName("card-hover")) {
                if(carr.id == current_name_hover) {
                  continue;
                }
                carr.style = "width: 0%;";
                carr.innerHTML = "";
              }
              if(document.getElementById(current_name).className == "portal fas fa-caret-left fa-10x float-right") {
                document.getElementById(current_name).className = "portal fas fa-caret-right fa-10x float-right";
                document.getElementById(current_name).style = "right: 1%;";
                document.getElementById(current_name_hover).style = "width: 0%;";
                document.getElementById(current_name_hover).innerHTML = "";
              } else {
                document.getElementById(current_name).className = "portal fas fa-caret-left fa-10x float-right";
                document.getElementById(current_name).style = "right: 46%;";
                document.getElementById(current_name_hover).style = "width: 45%; overflow-y: scroll";
                socket.emit("getMenu", current_id, current_name_hover);
              }
            };

            var cardImgOverlay = document.createElement("div");
            cardImgOverlay.className = "card-img-overlay";
            cardImgOverlay.appendChild(cardHover);
            cardImgOverlay.appendChild(cardTitle);
            
            var portal = document.createElement("a");
            portal.href = msg[i].page_address;
            portal.appendChild(cardImg);
            portal.appendChild(cardImgOverlay);
            

            var card = document.createElement("div");
            card.className = "card my-3 border-0 text-white";
            card.appendChild(portal);
            card.appendChild(carrot);

            element[0].appendChild(card);
          }
        });
      });
      
      socket.on("receiveMenu", function(menuData, current_name_hover) {
        var menu = document.createElement("div");
        for (item of menuData) {
          var menuItem = document.createElement("p");
          menuItem.innerHTML = item.foodName;
          //menuItem.innerHTML = item.cost;
          menu.appendChild(menuItem);
        }
        
        document.getElementById(current_name_hover).appendChild(menu);
      });
      
    </script>
    <footer>
        <div id="footer"></div>
        <script>
            $(function() {
            $("#footer").load("pfooter.html");
            });
        </script>
    </footer>
</body>